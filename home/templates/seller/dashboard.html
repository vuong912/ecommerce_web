{% extends 'seller_base.html' %}
{% load static %}
{% load humanize %}
{% block content %}
<section class="dashboard section">
    <!-- Container Start -->
    <div class="container">
        <!-- Row Start -->
        <div class="row">
            <div class="col-md-3 offset-md-1 col-lg-4 offset-lg-0">
                <div class="widget text-center">
                    <h5 class="widget-header title-text-color">Sản phẩm đã đăng</h5>
                    <a>
                        <p class="title-text-color">{{ merchandise_counter.all }}</p>
                        <p>Tất cả</p>
                    </a>
                    <a href="{% url 'seller:get_merchandises' %}?status=selling">
                        <p class="title-text-color">{{ merchandise_counter.selling }}</p>
                        <p>Đang bán</p>
                    </a>
                    <a href="{% url 'seller:get_merchandises' %}?status=sold_out">
                        <p class="title-text-color">{{ merchandise_counter.sold_out }}</p>
                        <p>Đã bán hết</p>
                    </a>
                    <a href="{% url 'seller:get_merchandises' %}?status=pending">
                        <p class="title-text-color">{{ merchandise_counter.pending }}</p>
                        <p>Đang chờ kiểm duyệt</p>
                    </a>
                    <a href="{% url 'seller:get_merchandises' %}?status=stopping">
                        <p class="title-text-color">{{ merchandise_counter.stopping }}</p>
                        <p>Đang dừng bán</p>
                    </a>
                    <a href="{% url 'seller:get_merchandises' %}?status=blocked">
                        <p class="title-text-color">{{ merchandise_counter.blocked }}</p>
                        <p>Bị khóa</p>
                    </a>
                    <a href="{% url 'seller:get_merchandises' %}?status=rejected">
                        <p class="title-text-color">{{ merchandise_counter.rejected }}</p>
                        <p>Bị từ chối</p>
                    </a>
                </div>
                <div class="widget text-center">
                    <h5 class="widget-header title-text-color">Hiệu quả hoạt động</h5>
                    {% for order_status in count_status %}
                    <a href="">
                        <p class="title-text-color">{{order_status.count}}</p>
                        <p>{{ order_status.name }}</p>
                    </a>
                    {% endfor %}
                </div>
                <div class="widget dashboard-container my-adslist">

                    <table class="table product-dashboard-table">
                        <thead>
                            <tr>
                                <th>CHƯƠNG TRÌNH KHUYẾN MÃI</th>
                                <th class="text-center"></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="product-details">
                                    <span class="status active">Sắp diễn ra</span>
                                    <p>Khuyến mãi mừng lễ 30/4, siêu giảm giá</p>
                                </td>

                                <td class="action">
                                    <div class="">
                                        <ul class="list-inline justify-content-center">

                                            <li class="list-inline-item">
                                                <a data-toggle="tooltip" data-placement="top" title="Đăng ký"
                                                    class="delete" href="">
                                                    <i class="fa fa-plus-circle"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="product-details">
                                    <span class="status active">Sắp diễn ra</span>
                                    <p>Khuyến mãi mừng lễ 30/4, siêu giảm giá</p>
                                </td>

                                <td class="action">
                                    <div class="">
                                        <ul class="list-inline justify-content-center">

                                            <li class="list-inline-item">
                                                <a data-toggle="tooltip" data-placement="top" title="Đăng ký"
                                                    class="delete" href="">
                                                    <i class="fa fa-plus-circle"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="col-md-10 offset-md-1 col-lg-8 offset-lg-0">
                <div class="col-md-12 box-analysic">
                    <div class="container">
                        <h3 class="title-text-color">Thống kê doanh thu</h3>
                        <canvas id="profit-chart" width="800" height="450"></canvas>
                        <br>
                        <div class="row">
                            <div class="col-sm">
                                <label for="profit-from-date">Từ: &nbsp;&nbsp;&nbsp;</label>
                                <input type="date" id="profit-from-date">
                            </div>
                            <div class="col-sm">
                                <label for="profit-to-date">Đến: &nbsp;&nbsp;&nbsp;</label>
                                <input type="date" id="profit-to-date">
                            </div>
                        </div>       
                    </div>
                </div>
                <!-- Recently Favorited -->

                <div class="widget dashboard-container my-adslist box-analysic">
                    <h3 class="widget-header">
                        SẢN PHẨM BÁN CHẠY NHẤT
                    </h3>
                    <div style="margin-bottom:20px">
                        <select>
                            <option>Doanh thu cao nhất</option>
                            <option>Số lượng bán ra nhiều nhất</option>
                        </select>
                    </div>
                    <table class="table table-responsive product-dashboard-table">
                        <thead>
                            <tr>
                                <th>Hình ảnh</th>
                                <th>Tên sản phẩm</th>
                                <th class="text-center">Số lượng</th>
                                <th class="text-center">Doanh thu</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for item in income_rank_list %}
                            <tr>
                                <td class="product-thumb">
                                    <img width="80px" height="auto" src="{{item.url}}"
                                        alt="image description">
                                </td>
                                <td class="product-details">
                                    <h3 class="title">{{item.name}}</h3>
                                </td>
                                <td class="action" data-title="Action">
                                    <p>{{item.count}}</p>
                                </td>
                                <td class="action" data-title="Action">
                                    <p>{{item.income|floatformat:0|intcomma}} VNĐ</p>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                </div>

                <!-- pagination -->
                <div class="pagination justify-content-center">
                    <nav aria-label="Page navigation example">
                        <ul class="pagination">
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Previous">
                                    <span aria-hidden="true">&laquo;</span>
                                    <span class="sr-only">Previous</span>
                                </a>
                            </li>
                            <li class="page-item"><a class="page-link" href="#">1</a></li>
                            <li class="page-item active"><a class="page-link" href="#">2</a></li>
                            <li class="page-item"><a class="page-link" href="#">3</a></li>
                            <li class="page-item">
                                <a class="page-link" href="#" aria-label="Next">
                                    <span aria-hidden="true">&raquo;</span>
                                    <span class="sr-only">Next</span>
                                </a>
                            </li>
                        </ul>
                    </nav>
                </div>
                <!-- pagination -->

            </div>
        </div>
        <!-- Row End -->
    </div>
    <!-- Container End -->
</section>
{% endblock %}

{% block js %}
<script>
    data = [{
        x: new Date("5/1/2020"),
        y: 1
    }, {
        t: new Date("5/2/2020"),
        y: 10
    }, {
        x: new Date("5/3/2020"),
        y: 4
    }, {
        x: new Date("6/1/2020"),
        y: 5
    }, {
        x: new Date("6/2/2020"),
        y: 9
    }, {
        x: new Date("8/25/2020"),
        y: 16
    }];
    
    //render_profit_chart(data)
    get_data_profit()
    function render_profit_chart(data){
        console.log(data)
        var ctx = document.getElementById('profit-chart').getContext('2d');
        var chart = new Chart(ctx, {
            type: 'bar',
            data: {

                datasets: [{
                    data: data,
                    fill: false,
                    borderColor: 'green'
                }]
            },
            options: {
                scales: {
                    xAxes: [{
                        type: 'time',
                        time: {
                            parser: 'MM/DD/YYYY HH:mm',
                            tooltipFormat: 'll HH:mm',
                            unit: 'month',
                            unitStepSize: 1,
                            displayFormats: {
                                'month': 'MM YYYY'
                            }
                        },
                    }],
                }
            }
    });
    }

    function get_data_profit(){
        $.ajax({
            type: "GET",
            url: "{% url 'seller:get_profit' %}",
            data: {},
            success: function (response) {
                render_profit_chart(response['data']);
            },
            error: function (response) {
                // alert the error if any error occured
                // console.log(response["responseJSON"]["error"]);
                switch (response.status) {
                    case 401:
                        alert("Xin hãy đăng nhập.");
                        break;
                    case 400:
                        alert(response["responseJSON"]["error"]);
                        break;
                    case 500:
                        alert("Đã có lỗi xảy ra, xin hãy thử lại sau.")
                        break;
                }
            }
        });

    }

</script>
{% endblock %}