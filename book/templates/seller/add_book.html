{% extends 'seller_base.html' %}
{% load static %}
{% block content %}
<section class="dashboard section">
    <!-- Container Start -->
    <div class="container">
        <!-- Row Start -->
        <div class="row">
            <div class="col-md-12">
                <!-- Recently Favorited -->
                <div class="widget dashboard-container my-adslist">
                    <h3 class="widget-header">THÊM SẢN PHẨM MỚI</h3>
                    <form method="POST" id="form-add-product">
                        {% csrf_token %}
                        <div class="form-group">
                            <label for="pro-name">1. Tên sản phẩm: </label>
                            <input type="text" class="form-control" id="pro-name" required>
                        </div>
                        
                        <div class="form-group">
                            <label>2. Hình đại diện: </label>
                            <a href="javascript:void(0)" onclick="$('#pro-avatar').click()"> + Chọn hình ảnh</a>
                            <input onchange="select_avatar(this);" type="file" id="pro-avatar" name="pro-avatar" hidden
                                class="form-control" accept="image/*">
                        </div>
                        <div id="selected_avatar"></div>

                        <div class="form-group">
                            <label>3. Hình ảnh sản phẩm: </label>
                            <a href="javascript:void(0)" onclick="$('#pro-images').click()"> + Thêm hình ảnh</a>
                            <input onchange="select_images(this);" type="file" id="pro-images" name="pro-images" hidden
                                class="form-control" accept="image/*" multiple>
                        </div>
                        <div class="container">
                            <div class="row preview-images-zone" id="selected_images"></div>
                        </div>
                        
                        <div class="form-group">
                            <label for="pro-portfolio">4. Loại sản phẩm: </label>
                            <select id="pro-portfolio" class="form-control">
                                <option selected>Sách</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>5. Chi tiết sản phẩm</label>
                            <div class="col-md-12" style="padding-right:30px">
                                <table class="table table-add-products">
                                    <tbody>
                                        <tr class="form-group">
                                            <td><label for="pro-publisher">Nhà xuất bản:</label> </td>
                                            <td><input class="form-control" type="text" class="input-add-spec" id="pro-publisher" name="pro-publisher"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-publicdate">Ngày xuất bản:</label> </td>
                                            <td><input class="form-control" type="month" class="input-add-spec" id="pro-publicdate" name="pro-publicdate"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-length">Kích thước:</label> </td>
                                            <td class="row">
                                                <div class="col">
                                                    <input class="form-control input-add-spec" type="number" placeholder="Dài (cm)" id="pro-length" name="pro-length">
                                                </div>
                                                <div class="col">
                                                    <input class="form-control input-add-spec" type="number" placeholder="Rộng (cm)" id="pro-width" name="pro-width">
                                                </div>
                                                <div class="col">
                                                    <input class="form-control input-add-spec" type="number" placeholder="Cao (cm)" id="pro-height" name="pro-height">
                                                </div>
                                            </td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-pagesnum">Số trang:</label> </td>
                                            <td><input class="form-control" type="number" class="input-add-spec" id="pro-pagesnum" name="pro-pagesnum"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label>Chọn thể loại:</label> </td>
                                            <td><div class="list-group" id="category-selection">
                                            </div></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pro-quantity">6. Số lượng: </label>
                            <input type="number" class="form-control" id="pro-quantity" name="pro-quantity">
                        </div>
                        <div class="form-group">
                            <label for="pro-price">7. Giá: </label>
                            <input type="number" class="form-control" id="pro-price" name="pro-price">
                        </div>
                        <div class="form-group">
                            <label for="pro-originprice">8. Giá thị trường: </label>
                            <input type="number" class="form-control" id="pro-originprice" name="pro-originprice">
                        </div>
                        <div class="form-group">
                            <label for="pro-condition">9. Tình trạng: </label>
                            <select id="pro-condition" name="pro-condition" class="form-control">
                                <option selected>Mới</option>
                                <option>Cũ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>10. Phương thức giao hàng: </label>
                            <div class="form-check">
                                <input class="pro-delivery form-check-input" type="checkbox" value="1" id="pro-delivery-1">
                                <label class="form-check-label" for="pro-delivery-1">Nhà bán tự giao</label>
                            </div>
                            
                        </div>
                        <div class="form-group">
                            <label for="name">11. Địa chỉ: </label>
                            <div class="col-md-12" style="padding-right:30px">
                                <table class="table table-add-products">
                                    <tbody>
                                        <tr class="form-group">
                                            <td><label for="pro-owner">Tên người liên lạc:</label> </td>
                                            <td><input class="form-control" type="text" class="input-add-spec" id="pro-owner" name="pro-owner"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-phone">Số điện thoại:</label> </td>
                                            <td><input class="form-control" type="tel" class="input-add-spec" id="pro-phone" name="pro-phone"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-no">Số nhà:</label> </td>
                                            <td><input class="form-control" type="text" class="input-add-spec" id="pro-no" name="pro-no"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-street">Đường:</label> </td>
                                            <td><input class="form-control" type="text" class="input-add-spec" id="pro-street" name="pro-street"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-ward">Phường:</label> </td>
                                            <td><input class="form-control" type="text" class="input-add-spec" id="pro-ward" name="pro-ward"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-district">Quận:</label> </td>
                                            <td><input class="form-control" type="text" class="input-add-spec" id="pro-district" name="pro-district"></td>
                                        </tr>
                                        <tr class="form-group">
                                            <td><label for="pro-cities">Thành phố/Tỉnh thành:</label> </td>
                                            <td>
                                                <select name="pro-cities" id="pro-cities">
                                                    {% for city in cities %}
                                                    <option value="{{ city }}">{{ city }}</option>
                                                    {% endfor %}
                                                </select>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="pro-description">12. Mô tả sản phẩm: </label>
                            <textarea id="pro-description" name="pro-description" style="width: 100%;" class="input-add-prod" role="5"
                                placeholder="Thêm mô tả"></textarea>
                        </div>
                        <div class="text-right">
                            <button onclick="submit_form();" type="button" class="btn btn-primary">Thêm sản phẩm</button>
                        </div>
                        
                        
                    </form>
                </div>
                <p><br /><br /></p>
            </div>
        </div>
        <!-- Row End -->
    </div>
    <!-- Container End -->
    
</section>
{% endblock %}
{% block js %}
<script src="http://js.nicedit.com/nicEdit-latest.js" type="text/javascript"></script>
<script>
    bkLib.onDomLoaded(nicEditors.allTextAreas);
    var book_categories = JSON.parse('{{ book_categories|escapejs }}');

    var children_categories = {}
    for (var key in book_categories) {
        var value = book_categories[key]
        if (!(value.id_parent in children_categories)) {
            children_categories[value.id_parent] = []
        }
        children_categories[value.id_parent].push(value)

    }

    render_categories()

    function render_categories(parent_category = null) {
        $("#category-selection").empty();
        grandparent_category = null
        if (parent_category) {
            grandparent_category = book_categories[parent_category].id_parent
        }
        $("#category-selection").append(
            `
            <button onclick="back_category(${grandparent_category})" type="button" class="list-group-item list-group-item-action list-group-item-dark">
                <i class="fas fa-arrow-alt-circle-left"></i>
            </button>
        `
        );
        for (const item of children_categories[parent_category]) {
            $("#category-selection").append(
                `
                <button onclick="select_category(this, ${item.id})" type="button" class="list-group-item list-group-item-action">
                    ${item.name}
                </button>
            `
            )
        }
    }
    selected_category = null

    function back_category(id) {
        selected_category = null
        render_categories(id)
    }

    function select_category(sender, id) {
        if (id in children_categories) {
            render_categories(id)
        } else {
            if (selected_category) {
                selected_category.classList.remove("active")
            }
            sender.classList.add("active")
            selected_category = sender
        }
    }

    function select_images(sender) {
        $("#selected_images").empty()
        if (sender.files) {
            for (var item of sender.files) {
                console.log(item);
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#selected_images").append(
                    `
                        <div class="image-zone col-4"><img src="${e.target.result}" width="200" /></div>
                    `
                    )
                }
                reader.readAsDataURL(item);
            }
        }
    }

    function select_avatar(sender) {
        $("#selected_avatar").empty()
        if (sender.files) {
            for (var item of sender.files) {
                console.log(item);
                var reader = new FileReader();
                reader.onload = function (e) {
                    $("#selected_avatar").append(
                        `
                        <div class="image-zone"><img src="${e.target.result}" width="200" /></div>
                    `
                    )
                }
                reader.readAsDataURL(item);
            }
        }
    }

    function submit_form(){
        console.log("Herer");
        form_data = new FormData(document.getElementById("form-add-product"));
        console.log(form_data);
        for(var pair of form_data.entries()) {
            console.log(pair[0]+ ', '+ pair[1]); 
        }
    }

</script>
{% endblock %}